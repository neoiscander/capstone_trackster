define(["require","jquery"],function(t){"use strict";var s=function(t,s){this.$el=t,this.app=s},a=t("jquery");return s.prototype={ERROR_MESSAGE_DURATION:5e3,constructor:s,start:function(){this.statusBar=this.$el.find(".js-player-status"),this.errorStatusBar=this.$el.find(".js-player-error"),this.errorStatusMessage=this.$el.find(".js-player-error-message"),this.setStatusMessage("inactive"),this.app.eventMediator.subscribe("player.track.playing",this.showPlayingStatus.bind(this)),this.app.eventMediator.subscribe("player.track.stopped",this.disable.bind(this)),this.app.eventMediator.subscribe("player.track.finished",this.disable.bind(this)),this.app.eventMediator.subscribe("player.ad.playing",this.adPlaying.bind(this)),this.app.eventMediator.subscribe("player.spotify.initialising",this.setStatusMessage.bind(this,"loading-spotify")),this.app.eventMediator.subscribe("player.spotify.abort",this.setStatusMessage.bind(this,"inactive")),this.app.eventMediator.subscribe("player.spotify.signup.start",this.setStatusMessage.bind(this,"spotify-signup")),this.app.eventMediator.subscribe("player.spotify.signup.end",this.setStatusMessage.bind(this,"inactive")),this.app.eventMediator.subscribe("player.spotify.error.auth-error",this.setStatusMessage.bind(this,"spotify-auth-error")),this.app.eventMediator.subscribe("player.playlist.request.error",this.setErrorMessage.bind(this,"cannot-play-item")),this.app.eventMediator.subscribe("player.track.unavailable",this.setErrorMessage.bind(this,"track-unavailable"))},showPlayingStatus:function(t){var s=a("<a />").addClass("player-bar-artist-name").attr("href",t.artistUrl).text(t.artistName),e=a("<a></a>").addClass("player-bar-track-name").attr("href",t.trackUrl).text(t.trackName);this.statusBar.html(e.prop("outerHTML")+s.prop("outerHTML")),this.statusBar.attr("title",t.trackName+" â€” "+t.artistName)},disable:function(){this.setStatusMessage("inactive")},adPlaying:function(){this.setStatusMessage("ad-playing")},setStatusMessage:function(t){var s=this.$el.data("player-status-"+t);this.setStatus(s)},setStatus:function(t){this.statusBar.html(t),this.statusBar.attr("title",this.statusBar.text())},setErrorMessage:function(t){clearTimeout(this.errorMessageTimeout);var s=this.$el.data("player-error-"+t);this.errorStatusBar.removeClass("player-bar-status--hide"),this.errorStatusMessage.text(s),this.errorStatusMessage.attr("title",s),this.statusBar.addClass("player-bar-status--hide"),this.errorMessageTimeout=setTimeout(function(){this.errorStatusBar.addClass("player-bar-status--hide"),this.statusBar.removeClass("player-bar-status--hide")}.bind(this),this.ERROR_MESSAGE_DURATION)}},s});